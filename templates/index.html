<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Pneumonia Detection ‚Äî Chest X-Ray</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                color: #fff;
            }

            .container {
                background: rgba(255, 255, 255, 0.08);
                backdrop-filter: blur(12px);
                border: 1px solid rgba(255, 255, 255, 0.15);
                border-radius: 20px;
                padding: 40px 36px;
                width: 480px;
                max-width: 95%;
                text-align: center;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.35);
            }

            h1 {
                font-size: 1.8rem;
                margin-bottom: 6px;
            }

            .subtitle {
                font-size: 0.95rem;
                color: #b0c4d8;
                margin-bottom: 28px;
            }

            /* ‚îÄ‚îÄ Upload Area ‚îÄ‚îÄ */
            .upload-area {
                border: 2px dashed rgba(255, 255, 255, 0.35);
                border-radius: 14px;
                padding: 40px 20px;
                cursor: pointer;
                transition:
                    border-color 0.3s,
                    background 0.3s;
                margin-bottom: 20px;
                position: relative;
            }
            .upload-area:hover,
            .upload-area.dragover {
                border-color: #4fc3f7;
                background: rgba(79, 195, 247, 0.08);
            }
            .upload-area svg {
                width: 52px;
                height: 52px;
                fill: #4fc3f7;
                margin-bottom: 12px;
            }
            .upload-area p {
                font-size: 0.95rem;
                color: #ccc;
            }
            .upload-area .browse {
                color: #4fc3f7;
                text-decoration: underline;
                cursor: pointer;
            }
            #fileInput {
                display: none;
            }

            /* ‚îÄ‚îÄ Preview ‚îÄ‚îÄ */
            .preview-wrapper {
                display: none;
                margin-bottom: 18px;
            }
            .preview-wrapper img {
                max-width: 100%;
                max-height: 260px;
                border-radius: 12px;
                border: 2px solid rgba(255, 255, 255, 0.2);
            }
            .file-name {
                font-size: 0.85rem;
                color: #aaa;
                margin-top: 6px;
                word-break: break-all;
            }

            /* ‚îÄ‚îÄ Button ‚îÄ‚îÄ */
            .btn {
                display: inline-block;
                width: 100%;
                padding: 14px;
                font-size: 1.05rem;
                font-weight: 600;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                background: linear-gradient(135deg, #00b4d8, #0077b6);
                color: #fff;
                transition: opacity 0.3s;
            }
            .btn:disabled {
                opacity: 0.45;
                cursor: not-allowed;
            }
            .btn:not(:disabled):hover {
                opacity: 0.88;
            }

            /* ‚îÄ‚îÄ Loader ‚îÄ‚îÄ */
            .loader {
                display: none;
                margin: 18px auto 0;
                width: 40px;
                height: 40px;
                border: 4px solid rgba(255, 255, 255, 0.2);
                border-top-color: #4fc3f7;
                border-radius: 50%;
                animation: spin 0.7s linear infinite;
            }
            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            /* ‚îÄ‚îÄ Result Card ‚îÄ‚îÄ */
            .result {
                display: none;
                margin-top: 24px;
                padding: 22px;
                border-radius: 14px;
                text-align: center;
            }
            .result.pneumonia {
                background: rgba(239, 83, 80, 0.18);
                border: 1px solid #ef5350;
            }
            .result.regular {
                background: rgba(102, 187, 106, 0.18);
                border: 1px solid #66bb6a;
            }

            .result .icon {
                font-size: 2.4rem;
                margin-bottom: 8px;
            }
            .result .label {
                font-size: 1.35rem;
                font-weight: 700;
            }
            .result .conf {
                font-size: 1rem;
                color: #ccc;
                margin-top: 4px;
            }
            .result .desc {
                font-size: 0.9rem;
                color: #b0b0b0;
                margin-top: 10px;
                line-height: 1.5;
            }

            .error-msg {
                display: none;
                margin-top: 16px;
                padding: 12px;
                border-radius: 10px;
                background: rgba(239, 83, 80, 0.15);
                border: 1px solid #ef5350;
                color: #ff8a80;
                font-size: 0.9rem;
            }

            footer {
                margin-top: 28px;
                font-size: 0.78rem;
                color: #667;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ü´Å Pneumonia Detector</h1>
            <p class="subtitle">
                Upload a chest X-ray image to check for pneumonia
            </p>

            <!-- Upload Area -->
            <div class="upload-area" id="dropZone">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path
                        d="M19.35 10.04A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 0 0 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"
                    />
                </svg>
                <p>
                    Drag & drop your X-ray here<br />or
                    <span class="browse">browse files</span>
                </p>
                <input type="file" id="fileInput" accept="image/*" />
            </div>

            <!-- Image Preview -->
            <div class="preview-wrapper" id="previewWrapper">
                <img id="previewImg" src="" alt="X-ray preview" />
                <p class="file-name" id="fileName"></p>
            </div>

            <!-- Submit -->
            <button class="btn" id="predictBtn" disabled>Analyze X-Ray</button>
            <div class="loader" id="loader"></div>

            <!-- Result -->
            <div class="result" id="result">
                <div class="icon" id="resultIcon"></div>
                <div class="label" id="resultLabel"></div>
                <div class="conf" id="resultConf"></div>
                <div class="desc" id="resultDesc"></div>
            </div>

            <!-- Error -->
            <div class="error-msg" id="errorMsg"></div>

            <footer>
                Powered by PyTorch &amp; Flask &bull; ResNet18 Transfer Learning
            </footer>
        </div>

        <script>
            const dropZone = document.getElementById("dropZone");
            const fileInput = document.getElementById("fileInput");
            const previewWrapper = document.getElementById("previewWrapper");
            const previewImg = document.getElementById("previewImg");
            const fileName = document.getElementById("fileName");
            const predictBtn = document.getElementById("predictBtn");
            const loader = document.getElementById("loader");
            const result = document.getElementById("result");
            const errorMsg = document.getElementById("errorMsg");

            let selectedFile = null;

            // ‚îÄ‚îÄ Drag & Drop ‚îÄ‚îÄ
            ["dragenter", "dragover"].forEach((e) =>
                dropZone.addEventListener(e, (ev) => {
                    ev.preventDefault();
                    dropZone.classList.add("dragover");
                }),
            );
            ["dragleave", "drop"].forEach((e) =>
                dropZone.addEventListener(e, (ev) => {
                    ev.preventDefault();
                    dropZone.classList.remove("dragover");
                }),
            );

            dropZone.addEventListener("drop", (e) =>
                handleFile(e.dataTransfer.files[0]),
            );
            dropZone.addEventListener("click", () => fileInput.click());
            fileInput.addEventListener("change", () =>
                handleFile(fileInput.files[0]),
            );

            function handleFile(file) {
                if (!file) return;
                selectedFile = file;
                fileName.textContent = file.name;
                previewImg.src = URL.createObjectURL(file);
                previewWrapper.style.display = "block";
                predictBtn.disabled = false;
                result.style.display = "none";
                errorMsg.style.display = "none";
            }

            // ‚îÄ‚îÄ Predict ‚îÄ‚îÄ
            predictBtn.addEventListener("click", async () => {
                if (!selectedFile) return;

                predictBtn.disabled = true;
                loader.style.display = "block";
                result.style.display = "none";
                errorMsg.style.display = "none";

                const formData = new FormData();
                formData.append("file", selectedFile);

                try {
                    const res = await fetch("/predict", {
                        method: "POST",
                        body: formData,
                    });
                    const data = await res.json();

                    if (!res.ok) throw new Error(data.error || "Server error");

                    const isPneumonia = data.prediction === "Pneumonia";

                    result.className =
                        "result " + (isPneumonia ? "pneumonia" : "regular");
                    document.getElementById("resultIcon").textContent =
                        isPneumonia ? "‚ö†Ô∏è" : "‚úÖ";
                    document.getElementById("resultLabel").textContent =
                        data.prediction;
                    document.getElementById("resultConf").textContent =
                        `Confidence: ${data.confidence}%`;
                    document.getElementById("resultDesc").textContent =
                        isPneumonia
                            ? "Signs of pneumonia detected in the X-ray. Please consult a medical professional for a proper diagnosis."
                            : "No signs of pneumonia detected. The lungs appear normal in this X-ray.";

                    result.style.display = "block";
                } catch (err) {
                    errorMsg.textContent = err.message;
                    errorMsg.style.display = "block";
                } finally {
                    loader.style.display = "none";
                    predictBtn.disabled = false;
                }
            });
        </script>
    </body>
</html>
